## Analisi delle chiamate API

Strumenti come **API Logger** ed **API Monitor** sono tool utili per l'analisi delle chiamate alle API con relativi parametri.

## Analisi dei processi

**ProcessMonitor** e **ProcessExplorer** utili per analizzare il comportamento dei processi, il primo nel comportamento il secondo in altri dettagli.

In ProcessMonitor è possibile filtrare l'elenco dei dati raccolti sui processi in esecuzione per nome, architettura, traffico di rete, parentela...
In ProcessExplorer è inoltre possibile verificare nelle proprietà del processo verificare se il file .exe è digitalmente firmato e di verificare, nella tab _Strings_, se il contenuto del file su disco _Image_ è uguale o diverso da quanto caricato in memoria (attacco di ProcessHollowing).  

## Analisi del Registro di Sistema

L'analisi del registro di sistema è utile per determinare il comportamento del malware. Tool come **RegShot** scansionano il registro e le cartelle indicate prima e dopo l'esecuzione del malware e restituiscono le differenze. 

## Uso di Debuggers

L'uso di debuggers permette un analisi dinamica avanzata in quanto è possbile manipolare a piacimento l'esecuzione di un malware e di modificarne temporaneamente il contenuto per disarmare eventuali tecniche di evasione.

## Tecniche di Dynamic Analysis Evasion

- identificazione dell'ambiente in cui il malware è eseguito, se riconosce tratti (come driver di VM (VMWare, Virtualbox...), RAM e CPU limitate...) tipici di sistemi virtualizzati, non viene eseguita alcuna operazione malevola o addirittura sono eseguite operazioni "benevole"
- identificazione dell'ambiente tramite lunghe attese nelle chiamate di funzione usando, ad esempio, la libreria Sleep di Windows. Questi controlli prevedono appunto lunghe attese, anche di giorni, prima di effettuare funzioni malevole nel tentativo di aggirare le sandbox (o simili) che rimangono attive per pochi minuti. Alcuni di questi strumenti di analisi dinamica tentano di aggirare queste tecniche manipolando data e ora del sistema operativo, a cui i malware possono rispondere comparando il tempo di prima esecuzione con quello rilevato alla fine del tempo di sospensione imposto della funzione sleep
- identificazione dell'ambiente in base all'attività dell'utente... pochi file, poca o nulla cronologia, assenza di movimento del mouse e della tastiera
- identificazione di strumenti di analisi come ProcMon, ProcExp e simili sia se in esecuzione, sia se risultano tra i processi in uso

## Tecniche di Anti-Reverse Engineering

- identificazione della presenza di debuggers (es. tramite API `IsDebuggerPresent`)
    - `EnumWindows` cercando tra le finestre aperte nomi come _debug_, _dbg_, _debugger_ + `SuspendThread` per sospendere l'eventuale debugger trovato
- manomissione di file legati ai debuggers per prevenirne l'uso
- sviluppo di codice in grado di modificarsi durante l'esecuzione rendendo molto più complicato l'analisi del codice tramite debugger


