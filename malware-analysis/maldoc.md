## PDF

Le quattro parti principali di un file PDF sono l'header, il body, la cross-reference table e il trailer.

**Header**  
`/Producer` contiene informazioni sul programma usato per generare il file PDF. Questa informazione potrebbe rivelarsi utile in quanto alcuni APT o gruppi usano specifici software o versioni di software e quindi è possibile ricollegarli al file.  
Nel caso di Threat Hunting o IR si può usare come "signature" (anche se debole) per l'identificazione di file PDF malevoli.

**Body**  
Nel body si trovano diversi elementi come gli Strems (identificati dalle keyword *stream* e *endstream*), arrays, dizionari, nomi e oggetti.  
Gli oggetti hanno un valore numerico univoco e possono referenziare altri oggetti in quanto la struttura di un file PDF è gerarchica.  

Gli stream possono essere compressi per ridurre la dimensione del file finale e quindi non leggibili con comandi come **strings**.  
La keyword `/Filter` specifica la compressione applicata allo Stream.  

**Trailer**  
`/Size` riporta il numero di oggetti nel file PDF.

**Cross-reference table**  
Poco sopra il trailer si trova la sezione `xref` che contiene gli offset di ogni oggetto. Questa tabella aiuta i lettori di file PDF nell'individuare agilmente la posizione di ogni oggetto senza effettuare il parsing/lettura dell'intero file.  

---
Analisi delle funzioni interne ai PDF chiamate da determinate keyword come `/JS`, `/Javascript`, `/OpenAction`...

**peepdf** utile per identificare la struttura di un file PDF, come il numero di oggetti totale e per quali oggetti sono presenti azioni come `/OpenAction`, `/JS`, `/Javascript`, `/EmbeddedFiles` e così via.  

**pdf-parser.py** si occupa di effettuare il parsing del file PDF ed è possibile specificare tra i vari parametri il numero dell'oggetto da analizzare.  
Se un oggetto sembra vuoto è comunque buona cosa effettuare il dump in un file su disco erché potrebbe essere un **file binario** (come un PE).

## JS

Esecuzione dei file Javascript spesso obfuscated e con nomi di variabili generati casualmente, in mini sandbox come con `box-js`.

## OLE, OOXML e RTF

VBA, Exploits, Embedded objects...

1. Estrazione delle macro (es. usando OLEVBA)
2. Analisi statica delle macro in editor di testo
3. Emulazione delle macro per l'ottenimento di eventuali file scaricati (es. usando ViperMonkey)
4. Analisi del file scaricato via PE-BEAR per determinarne correttamente il tipo (DLL, EXE) in caso in cui le istruzioni di prima identifichino un droppper
5. Se si tratta di un dropper, ricerare tramite debugger il "pezzo" di codice che contiene il dump del file eseguibile finale, salvare il dump con estensione .exe
6. Ripetere l'analisi con PE-BEAR e se si tratta del malware finale, analizzarlo di conseguenza


I file OfficeOpenXML, supportati in Microsoft e riconoscibili dall'estensione con la **x**, si basano sullo schema XML per costruire la propria struttura interna. Questi file **non** possono contenere codice VBA.  
Nelle versioni invece con Macro, la versione del file ha estensione con **m** finale.

I file Object Linking and Embedding (doc, xls, ppt...) possono contenere codice VBA e sono stati sviluppati originariamente da Microsoft. Questi file sono intrisicamente legati al concetto di COM per la condivisione e inclusione di funzionalità tra i programmi, ad esempio in Word è possibile includere una tabella di Excel.  

**oleid** per ottenere informazioni sul file.  
**olevba** per estrarre e avere output di macro contenute nel file passato come argomento.  
**oleobj** per estrarre file binari da VBA.  
**vipermonkey** come sopra + emulazione. 

I file Rich Text Format (.rtf) supportano una formattazione basica e il suo scopo serve (serviva) a colmare un vuoto di interoperabilità tra i diversi sistemi operativi.  

 **rtfdump.py** output gli stream contenuti nel file RTF. 
 **rtfobj** per fare il dump degli stream in file binari.  
 **xorsearch** per individiare l'EIP del file binario nel caso risulti "malformato".  
 **scdbug** esegue debug della schellcode a partire dall'indirizzo EIP indicato, ad esempio stampa stringhe/windows API invocate e relativi argomenti.  
 


